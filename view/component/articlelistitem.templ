package component

import "newser.app/model"
import "strconv"

func getImgAlt(imgTitle, feedTitle string) string {
	alt := ""
	if imgTitle != "" {
		alt = imgTitle
	} else if feedTitle != "" {
		alt = feedTitle
	}
	return alt
}

templ ArticleListItem(article *model.Article) {
	<li class="article-list-item card">
		<div class="card-header flex-column">
			<div class="flex-row flex-align-center gap-1">
				if article.FeedImageUrl != "" {
					<image class="feed-logo" src={ article.FeedImageUrl } alt={ getImgAlt(article.FeedImageTitle, article.FeedTitle) }></image>
				}
				<a href={ templ.SafeURL("/desk/articles/" + article.Slug) } class="card-primary-action">
					<h3>{ article.Title }</h3>
				</a>
			</div>
			<div class="flex-row flex-between">
				@FormattedDateTime(article.PublishedParsed)
			</div>
		</div>
		<div class="card-body">
			<p>{ article.Description }</p>
		</div>
		<div class="card-footer">
			@CardMenu(article)
		</div>
	</li>
}

func idToString(id int64) string {
	return strconv.FormatInt(id, 10)
}

templ CardMenu(article *model.Article) {
	<ul class="card-menu flex-menu">
		// <li class="tooltip-container">
		// 	<a class="icon-link" href={ templ.SafeURL("/items/tags/" + entry.id) } aria-label="Add Tags">
		// 		// <Icon name="tag" />
		// 		@Icon("tag")
		// 	</a>
		// 	<span role="status" class="tooltip">Add Tags</span>
		// </li>
		<li class="tooltip-container">
			<form action="/desk/collections/add-article" method="post">
				<input type="hidden" name="articleId" value={ idToString(article.ID) }/>
				<input type="hidden" name="collectionName" value="Read Later"/>
				<button class="icon-link-button" type="submit" aria-label="Bookmark Post">
					@Icon("bookmark")
				</button>
				<span role="status" class="tooltip">Bookmark Post</span>
			</form>
		</li>
		<li class="tooltip-container">
			<form action="/desk/collections/add-article" method="post">
				<input type="hidden" name="entryId" value={ idToString(article.ID) }/>
				<input type="hidden" name="collectionName" value="Some New Collection"/>
				<button class="icon-link-button" type="submit" aria-label="Add to Collection">
					// <Icon name="folder_add" />
					@Icon("folder_add")
				</button>
				<span role="status" class="tooltip">Add to Collection</span>
			</form>
		</li>
		<li class="tooltip-container">
			<form action="/desk/collections/add-entry" method="post">
				<input type="hidden" name="entryId" value={ idToString(article.ID) }/>
				// <input type="hidden" name="collectionName" value={ entry.read ? "Unread" : "Read" }/>
				// <button class="icon-link-button" aria-label={ entry.read ? "Mark Unread" : "Mark Read" }>
				// <Icon name={entry.read ? "checkbox_circle_outline" : "checkbox_circle_fill"} />
				<button class="icon-link-button">
					@Icon("checkbox_circle_outline")
				</button>
				// <span role="status" class="tooltip">{ entry.read ? "Mark Unread" : "Mark Read" }</span>
			</form>
		</li>
	</ul>
}
